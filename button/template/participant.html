{% extends 'bt_head.html' %}

{% block content %}

 <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-12">
  <div id="t1" class="m_title"><h4><strong>{{ title }}</strong></h4></div>
 </div>

 <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6 col-xs-12">
  <div id="t2" class="m_user"><h4><strong>{{ m_user }}</strong></h4></div>
 </div>
</div>

<div class="caption">
  <span id="info" style="cursor:default;">Kad būs īstais laiks, tad padošu ziņu un visu redzēsi</span>
  <img id="button_img" class="center_img" src="https://svabis.eu/static/button.jpeg" onclick="sC();" style="display:none;">
  <span id="button" style="color: #d90007;" onclick="sC();"></span>

<audio controls id="ns" style="display: none;">
  <source src="https://svabis.eu/static/check.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio>

<script>
var i;var cC; $(document).ready(function () { i = setInterval(tI, 3000); }); var mId; var pId; var tempC; $(document).ready(function(){ var cook = document.cookie; cook = cook.replace(/\s/g, ""); cook = cook.split(";"); cook.forEach(iC); cC = setInterval( function () { var cook = document.cookie; cook = cook.replace(/\s/g, ""); cook = cook.split(";"); cook.forEach(iC); }, 10000); var temp=tempC.split(":"); mId=temp[0]; pId=temp[1]; })
function iC(value, index, array) { if (value.match("button")) { value = value.split("="); if (typeof(mId) == "undefined") { mId=value[1]; tempC=value[1]; } else { if (tempC != value[1] ) { cancel(); } } }} var iP = false;var sP = false;var cD;var d;var n = document.getElementById("ns");n.loop = true;function pN() { n.play(); } function sN() { n.pause();; n.currentTime = 0; } function cl() { clearInterval(cC); clearInterval(cD); clearInterval(i); $("#info").html("Viss ir slikti..."); $("#info").show(); $("#button_img").hide(); $("#button").hide(); $("#t1").hide(); $("#t2").hide();} function sC() { if (!sP) { sN(); var t = document.querySelector("#button").innerHTML; uB( t ); i = setInterval(tI, 3000); clearInterval(cD); document.querySelector("#button").innerHTML = "Nospiedi!"; setTimeout(r, 15000); sP = true;}} function r() { document.title = "{{title}}"; iP = false; sP = false; $("#info").show(); $("#button_img").hide(); $("#button").hide();} function aT() {  document.title = "Spied!"; clearInterval(i); iP = true; $("#info").hide(); $("#button_img").show(); $("#button").show(); $("#button_img").focus(); pN(); display = document.querySelector("#button"); display.focus(); display.innerHTML ="00:00"; var tt = d, m, s; cD = setInterval(function () { m = parseInt(tt / 60, 10); s = parseInt(tt % 60, 10); m = m < 10 ? "0" + m : m; s = s < 10 ? "0" + s : s; display.textContent = m + ":" + s; if (--tt < 0) { sN(); tt = d; clearInterval(cD); d = 59; display.innerHTML = "Nokavēji!"; i = setInterval(tI, 3000); setTimeout(r, 15000);}}, 1000);}function tI() { $.ajax({ url:"../button/press/", type: "GET", data: {data: mId, p_id: pId}, success:function(response){ if (response.split(" ")[0] == "push") { if (!iP) { d = parseInt( response.split(" ")[1] ); aT();}} if (response == "ended") { clearInterval(i); iP = false; $("#info").show(); $("#info").html("Pasākums ir beidzies, vari negaidīt"); $("#button_img").hide(); $("#button").hide(); }}, complete:function(){}, error:function (xhr, textStatus, thrownError){}});}function uB( t ) { $.ajax({ url:"../button/push/", type: "GET", data: {data: mId, p_id: pId, time: t}, success:function(response){}, complete:function(){}, error:function (xhr, textStatus, thrownError){}});}
</script>

</div>

{% endblock %}

